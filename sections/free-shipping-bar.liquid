{% comment %}
  Get current country and set appropriate threshold
{% endcomment %}
{% assign current_country = localization.country.iso_code %}
{% assign free_shipping_goal = section.settings.free_shipping_amount %}

{% comment %}
  Set different thresholds based on country/region
{% endcomment %}
{% case current_country %}
  {% when 'US' %}
    {% assign free_shipping_goal = 50 %}
  {% when 'CA' %}
    {% assign free_shipping_goal = 75 %}
  {% when 'GB' %}
    {% assign free_shipping_goal = 40 %}
  {% when 'DE', 'FR', 'IT', 'ES', 'NL', 'BE', 'AT', 'CH' %}
    {% assign free_shipping_goal = 60 %}
  {% when 'AU' %}
    {% assign free_shipping_goal = 80 %}
  {% when 'JP' %}
    {% assign free_shipping_goal = 5000 %}
  {% else %}
    {% assign free_shipping_goal = section.settings.free_shipping_amount %}
{% endcase %}

{% assign free_shipping_goal_cents = free_shipping_goal | times: 100 %}
{% comment %}
  Note: Shopify returns prices in cents. So we multiply by 100 to compare correctly.
{% endcomment %}

<div
  id="free-shipping-bar-{{ section.id }}"
  class="free-shipping-bar"
  data-free-shipping-goal="{{ free_shipping_goal_cents }}"
  data-current-country="{{ current_country }}"
  data-translations="{{ 'general.free_shipping.remaining_amount' | t }},{{ 'general.free_shipping.you_qualify' | t }}"
>
  <div class="free-shipping-message">
    {{ 'general.free_shipping.remaining_amount' | t: amount: free_shipping_goal | money }}
  </div>

  <div class="progress-bar-container" style="background-color: {{ section.settings.bar_background }};">
    <div
      class="progress-bar-fill"
      style="background-color: {{ section.settings.bar_color }}; width: 0%;"
    ></div>
  </div>
</div>

{% schema %}
{
  "name": "Free Shipping Bar",
  "settings": [
    {
      "type": "header",
      "content": "Free Shipping Thresholds"
    },
    {
      "type": "paragraph",
      "content": "The following thresholds are automatically applied based on customer location:"
    },
    {
      "type": "paragraph",
      "content": "• US: $50 • CA: $75 • GB: £40 • EU: €60 • AU: $80 • JP: ¥5000"
    },
    {
      "type": "number",
      "id": "free_shipping_amount",
      "label": "Default free shipping amount (overwiten by country settings)",
      "default": 50
    },
    {
      "type": "header",
      "content": "Style Settings"
    },
    {
      "type": "color",
      "id": "bar_color",
      "label": "Bar color",
      "default": "#ff6699"
    },
    {
      "type": "color",
      "id": "bar_background",
      "label": "Background color",
      "default": "#eee"
    },
    {
      "type": "checkbox",
      "id": "show_on_homepage",
      "label": "Show on home page",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Free Shipping Progress Bar"
    }
  ]
}
{% endschema %}
