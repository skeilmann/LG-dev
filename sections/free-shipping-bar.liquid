{% comment %}
  Get current country and set appropriate threshold
{% endcomment %}
{% assign current_country = localization.country.iso_code %}
{% assign free_shipping_goal = section.settings.free_shipping_amount %}

{% comment %}
  Set different thresholds based on country/region groups
{% endcomment %}
{% case current_country %}
  {% when 'MD' %}
    {% assign free_shipping_goal = section.settings.moldova_threshold %}
  {% when 'RO' %}
    {% assign free_shipping_goal = section.settings.romania_threshold %}
  {% when 'DE',
    'FR',
    'IT',
    'ES',
    'NL',
    'BE',
    'AT',
    'CH',
    'GB',
    'IE',
    'PT',
    'SE',
    'NO',
    'DK',
    'FI',
    'PL',
    'CZ',
    'SK',
    'HU',
    'BG',
    'HR',
    'SI',
    'EE',
    'LV',
    'LT',
    'MT',
    'CY',
    'LU',
    'GR'
  %}
    {% assign free_shipping_goal = section.settings.europe_threshold %}
  {% else %}
    {% assign free_shipping_goal = section.settings.world_threshold %}
{% endcase %}

{% assign free_shipping_goal_cents = free_shipping_goal | times: 100 %}
{% comment %}
  Note: Shopify returns prices in cents. So we multiply by 100 to compare correctly.
{% endcomment %}

<div class="page-width">
  <div
    id="free-shipping-bar-{{ section.id }}"
    class="free-shipping-bar"
    data-free-shipping-goal="{{ free_shipping_goal_cents }}"
    data-current-country="{{ current_country }}"
    data-currency-symbol="{{ cart.currency.symbol }}"
    data-translations="{{ 'general.free_shipping.title' | t }},{{ 'general.free_shipping.add_more' | t }},{{ 'general.free_shipping.more_for_free_shipping' | t }},{{ 'general.free_shipping.you_qualify' | t }},{{ 'general.free_shipping.remaining_amount' | t }}"
  >
    <div class="free-shipping-header">
      <h3 class="free-shipping-title">{{ 'general.free_shipping.title' | t }}</h3>
      <div class="free-shipping-amount">
        <span class="free-shipping-current">{{ cart.total_price | money }}</span>
        <span> / </span>
        <span class="free-shipping-target">{{ free_shipping_goal | times: 100 | money }}</span>
      </div>
    </div>

    <div class="progress-bar-container" style="background-color: {{ section.settings.bar_background }};">
      <div
        class="progress-bar-fill"
        style="background-color: {{ section.settings.bar_color }}; width: 0%;"
      ></div>
    </div>

    <div class="free-shipping-message">
      <span class="free-shipping-text"></span>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Free Shipping Bar",
  "settings": [
    {
      "type": "header",
      "content": "Free Shipping Thresholds"
    },
    {
      "type": "range",
      "id": "moldova_threshold",
      "min": 100,
      "max": 5000,
      "step": 100,
      "unit": "$",
      "label": "Moldova threshold",
      "default": 500
    },
    {
      "type": "range",
      "id": "romania_threshold",
      "min": 100,
      "max": 5000,
      "step": 100,
      "unit": "$",
      "label": "Romania threshold",
      "default": 1000
    },
    {
      "type": "range",
      "id": "europe_threshold",
      "min": 100,
      "max": 5000,
      "step": 100,
      "unit": "$",
      "label": "Europe threshold",
      "default": 3000
    },
    {
      "type": "range",
      "id": "world_threshold",
      "min": 100,
      "max": 5000,
      "step": 100,
      "unit": "$",
      "label": "World threshold",
      "default": 5000
    },
    {
      "type": "header",
      "content": "Style Settings"
    },
    {
      "type": "color",
      "id": "bar_color",
      "label": "Bar color",
      "default": "#ff6699"
    },
    {
      "type": "color",
      "id": "bar_background",
      "label": "Background color",
      "default": "#eee"
    },
    {
      "type": "checkbox",
      "id": "show_on_homepage",
      "label": "Show on home page",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Free Shipping Progress Bar"
    }
  ]
}
{% endschema %}
